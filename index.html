<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Location Updates</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <h1>Real-Time Location Updates</h1>

    <h2>My Location</h2>
    <div>
        Latitude: <span id="latitude">-</span><br>
        Longitude: <span id="longitude">-</span>
    </div>

    <h2>Other Users</h2>
    <ul id="users"></ul>

    <script>
        const socket = new WebSocket(`wss://${window.location.host}/ws`);

        // Update my location
        const updateLocation = (latitude, longitude) => {
            document.getElementById("latitude").textContent = latitude;
            document.getElementById("longitude").textContent = longitude;

            // Send location to the server
            socket.send(JSON.stringify({
                type: "location",
                latitude,
                longitude,
            }));
        };

        // Handle incoming location updates
        socket.addEventListener("message", (event) => {
            const data = JSON.parse(event.data);

            if (data.type === "location") {
                const usersList = document.getElementById("users");
                const userItem = document.createElement("li");
                userItem.textContent = `Lat: ${data.latitude}, Lon: ${data.longitude}`;
                usersList.appendChild(userItem);
            }
        });

        // Get the user's location
        if ("geolocation" in navigator) {
            navigator.geolocation.watchPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    updateLocation(latitude, longitude);
                },
                (error) => {
                    console.error("Error getting location:", error);
                }
            );
        } else {
            console.error("Geolocation is not supported by this browser.");
        }
    </script>
</body>
</html>